# Project Summary: Bus Control

**–î–∞—Ç–∞:** 2026-02-17  
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** Feature-Sliced Design (FSD)  
**–°—Ç–µ–∫:** React + TypeScript + Vite + Canvas API

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ProjectBusControl/
‚îú‚îÄ‚îÄ .editorconfig              # LF endings, 2 spaces
‚îú‚îÄ‚îÄ .prettierrc                # singleQuote, LF, 100 chars
‚îú‚îÄ‚îÄ eslint.config.js
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ vite.config.ts             # –ê–ª–∏–∞—Å: @ ‚Üí src/
‚îú‚îÄ‚îÄ tsconfig.*.json            # TypeScript config
‚îú‚îÄ‚îÄ index.html
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ main.tsx               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
    ‚îú‚îÄ‚îÄ App.tsx                # Root –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
    ‚îú‚îÄ‚îÄ index.css
    ‚îú‚îÄ‚îÄ app/
    ‚îÇ   ‚îú‚îÄ‚îÄ init.ts            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–¥—Ä–∞
    ‚îÇ   ‚îî‚îÄ‚îÄ store/
    ‚îÇ       ‚îî‚îÄ‚îÄ GameStateStore.ts
    ‚îú‚îÄ‚îÄ shared/
    ‚îÇ   ‚îî‚îÄ‚îÄ lib/
    ‚îÇ       ‚îî‚îÄ‚îÄ game-core/     # –ò–≥—Ä–æ–≤–æ–µ —è–¥—Ä–æ (7 —Å–µ—Ä–≤–∏—Å–æ–≤)
    ‚îú‚îÄ‚îÄ entities/
    ‚îÇ   ‚îú‚îÄ‚îÄ Bus/
    ‚îÇ   ‚îú‚îÄ‚îÄ NPC/
    ‚îÇ   ‚îú‚îÄ‚îÄ Route/
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ model/
    ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ RouteComponents.ts
    ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ RouteRenderSystem.ts
    ‚îÇ   ‚îî‚îÄ‚îÄ stop/
    ‚îÇ       ‚îî‚îÄ‚îÄ model/
    ‚îÇ           ‚îú‚îÄ‚îÄ StopComponents.ts
    ‚îÇ           ‚îî‚îÄ‚îÄ StopRenderSystem.ts
    ‚îú‚îÄ‚îÄ features/
    ‚îÇ   ‚îî‚îÄ‚îÄ map-editor/
    ‚îÇ       ‚îî‚îÄ‚îÄ model/
    ‚îÇ           ‚îî‚îÄ‚îÄ MapEditorService.ts
    ‚îî‚îÄ‚îÄ widgets/
        ‚îî‚îÄ‚îÄ game-canvas/
            ‚îú‚îÄ‚îÄ ui/
            ‚îÇ   ‚îú‚îÄ‚îÄ GameCanvas.tsx
            ‚îÇ   ‚îî‚îÄ‚îÄ GameCanvas.module.scss
            ‚îî‚îÄ‚îÄ index.ts
```

---

## üéÆ –ò–≥—Ä–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (MVP)

| –§—É–Ω–∫—Ü–∏—è | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|------------|----------|
| **–°–æ–∑–¥–∞–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫** | –õ–ö–ú (—Ä–µ–∂–∏–º 1) | –ó–µ–ª—ë–Ω—ã–µ –∫—Ä—É–≥–∏ —Å –Ω–∞–¥–ø–∏—Å—è–º–∏ Stop 1, Stop 2... |
| **–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤** | –ö–ª–∞–≤–∏—à–∞ 2 ‚Üí –õ–ö–ú –ø–æ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º | –°–∏–Ω–∏–µ –ª–∏–Ω–∏–∏ –º–µ–∂–¥—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏ |
| **–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã** | –°–ö–ú (–∑–∞–∂–∞—Ç—å –∫–æ–ª–µ—Å–æ) | –ü–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–º–µ—Ä—ã |
| **–ó—É–º** | –ö–æ–ª–µ—Å–æ –º—ã—à–∏ | –ó—É–º –≤ —Ç–æ—á–∫—É –∫—É—Ä—Å–æ—Ä–∞ |
| **–ó–∞–≤–µ—Ä—à–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç** | Enter / –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ | –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ (–º–∏–Ω. 2 –æ—Å—Ç–∞–Ω–æ–≤–∫–∏) |
| **–û—Ç–º–µ–Ω–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç** | Escape | –°–±—Ä–æ—Å —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞ |

### –°–ª–æ–∏ Canvas

```typescript
['background', 'roads', 'entities', 'ui']
// background: —Ç—ë–º–Ω–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω (#1a1a2e)
// roads: –ª–∏–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤
// entities: –æ—Å—Ç–∞–Ω–æ–≤–∫–∏, –∞–≤—Ç–æ–±—É—Å—ã, NPC
// ui: –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°–ª–æ–∏ FSD

| –°–ª–æ–π | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –§–∞–π–ª—ã |
|------|------------|-------|
| **app** | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Å—Ç–µ–π—Ç | `init.ts`, `GameStateStore.ts` |
| **shared** | –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –ª–æ–≥–∏–∫–∞ (—è–¥—Ä–æ) | 7 —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ `game-core/` |
| **entities** | –ë–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏ | Bus, NPC, Route, Stop |
| **features** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ | MapEditorService |
| **widgets** | UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã | GameCanvas |

### –Ø–¥—Ä–æ (Game Core)

| –°–µ—Ä–≤–∏—Å | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|--------|----------------|
| `GameLoopService` | –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª (fixed timestep 60 FPS) |
| `CanvasRendererService` | –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ (—Å–ª–æ–∏, –ø—Ä–∏–º–∏—Ç–∏–≤—ã, –∫–∞–º–µ—Ä–∞) |
| `EntityManagerService` | ECS: —Å—É—â–Ω–æ—Å—Ç–∏, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, —Å–∏—Å—Ç–µ–º—ã |
| `GameEventBusService` | Pub/Sub –¥–ª—è —Å–≤—è–∑–∏ React ‚Üî Canvas |
| `InputService` | –í–≤–æ–¥ (–º—ã—à—å, –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞, —Ç–∞—á) |
| `ResourceLoaderService` | –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Å—Å–µ—Ç–æ–≤ (–∫—ç—à, placeholders) |
| `CameraController` | –ö–∞–º–µ—Ä–∞ (–ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ –°–ö–ú, –∑—É–º –∫–æ–ª–µ—Å–æ–º) |

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Prettier (`.prettierrc`)

```json
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 2,
  "trailingComma": "es5",
  "printWidth": 100,
  "endOfLine": "lf"
}
```

### TypeScript (`tsconfig.app.json`)

```json
{
  "baseUrl": ".",
  "paths": {
    "@/*": ["./src/*"]
  }
}
```

### Git

```bash
git config core.eol lf
git config core.autocrlf false
```

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã

1. **refactor: —É–¥–∞–ª–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –ª–æ–≥–∏** ‚Äî –æ—á–∏—Å—Ç–∫–∞ console.log
2. **chore: –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å LF –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å—Ç—Ä–æ–∫** ‚Äî .editorconfig, .prettierrc
3. **feat: –¥–æ–±–∞–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã –∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ä—Ç** ‚Äî RouteComponents, RouteRenderSystem, MapEditorService

### –ö–ª—é—á–µ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- ‚úÖ **–ó–∞–¥–µ—Ä–∂–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Å—Ç–∞–Ω–æ–≤–æ–∫** ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ —Å `MOUSE_CLICK` –Ω–∞ `MOUSE_UP`
- ‚úÖ **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫** ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω React Strict Mode (bound handlers)
- ‚úÖ **–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω–∞ –°–ö–ú** ‚Äî —É–±—Ä–∞–Ω–æ —É—Å–ª–æ–≤–∏–µ `|| mouseState.isDragging`

---

## üöÄ –ó–∞–ø—É—Å–∫

```bash
npm install
npm run dev
```

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- **1** ‚Äî —Ä–µ–∂–∏–º –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ (–õ–ö–ú = —Å–æ–∑–¥–∞—Ç—å)
- **2** ‚Äî —Ä–µ–∂–∏–º –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–õ–ö–ú –ø–æ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º = –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É)
- **Enter** ‚Äî –∑–∞–≤–µ—Ä—à–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç
- **Escape** ‚Äî –æ—Ç–º–µ–Ω–∏—Ç—å
- **–°–ö–ú** ‚Äî –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã
- **–ö–æ–ª–µ—Å–æ** ‚Äî –∑—É–º

---

## üìã –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚úÖ
- [x] –û—Å—Ç–∞–Ω–æ–≤–∫–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥, –Ω–∞–¥–ø–∏—Å–∏)
- [x] –ú–∞—Ä—à—Ä—É—Ç—ã (–ª–∏–Ω–∏–∏ –º–µ–∂–¥—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏)
- [x] –ö–∞–º–µ—Ä–∞ (–ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ, –∑—É–º)
- [x] –†–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ä—Ç (—Ä–µ–∂–∏–º—ã 1/2)

### –í –ø–ª–∞–Ω–∞—Ö üîú
- [ ] –ê–≤—Ç–æ–±—É—Å (–¥–≤–∏–∂–µ–Ω–∏–µ –ø–æ –º–∞—Ä—à—Ä—É—Ç—É)
- [ ] –ü–∞—Å—Å–∞–∂–∏—Ä—ã (—Å–ø–∞–≤–Ω, –ø–æ—Å–∞–¥–∫–∞/–≤—ã—Å–∞–¥–∫–∞)
- [ ] –≠–∫–æ–Ω–æ–º–∏–∫–∞ (–±–∞–ª–∞–Ω—Å, –¥–æ—Ö–æ–¥/—Ä–∞—Å—Ö–æ–¥)
- [ ] UI (–∫–Ω–æ–ø–∫–∏, —Å—Ç–∞—Ç—ã, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **React Strict Mode** ‚Äî –¥–≤–æ–π–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (—Ä–µ—à–µ–Ω–æ —á–µ—Ä–µ–∑ `clearSubscribers()`)
2. **Window blur** ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ç–∞–π–º–µ—Ä—ã –∫–ª–∏–∫–æ–≤ (—Ä–µ—à–µ–Ω–æ: –Ω–µ –æ—á–∏—â–∞—Ç—å —Ç–∞–π–º–µ—Ä—ã)
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî –ø–µ—Ä–µ–±–æ—Ä –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ –≤ `findStopAtPosition()` (O(n), –¥–æ–ø—É—Å—Ç–∏–º–æ –¥–ª—è MVP)

---

**–°—Ç–∞—Ç—É—Å:** MVP –≥–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é! üéâ
